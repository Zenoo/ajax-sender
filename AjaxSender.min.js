class AjaxSender{constructor(e,r){if(this.xhr=new XMLHttpRequest,this._parameters={method:r.method||"GET",data:r.data||{},responseType:r.responseType||"json",headers:r.headers||{},progress:r.progress,load:r.load,error:r.error,uploadProgress:r.uploadProgress,uploadLoad:r.uploadLoad},this._handleCallbacks(),this.xhr.responseType=this._parameters.responseType,"GET"==this._parameters.method){const r=new URL(e);r.search+=(r.search.length&&Object.keys(this._parameters.data).length?"&":"")+this._objectToURL(this._parameters.data),this.xhr.open("GET",r.href)}else this.xhr.open(this._parameters.method,e);Object.entries(this._parameters.headers).forEach(([e,r])=>this.xhr.setRequestHeader(e,r)),"GET"==this._parameters.method?this.xhr.send():this._parameters.data instanceof FormData?(this._parameters.data.processData=!1,this._parameters.data.contentType=!1,this.xhr.send(this._parameters.data)):this.xhr.send(JSON.stringify(this._parameters.data))}_handleCallbacks(){this._parameters.progress&&this.xhr.addEventListener("progress",()=>{Reflect.apply(this._parameters.progress,null,[this.xhr.response])}),this._parameters.load&&this.xhr.addEventListener("load",()=>{200==this.xhr.status?Reflect.apply(this._parameters.load,null,[this.xhr.response]):this._parameters.error?Reflect.apply(this._parameters.error,null,[this.xhr]):console.log(this.xhr)}),this.xhr.addEventListener("error",this._parameters.error?()=>{Reflect.apply(this._parameters.error,null,[this.xhr])}:()=>{console.log(this.xhr)}),this._parameters.uploadProgress&&this.xhr.upload.addEventListener("progress",()=>{Reflect.apply(this._parameters.uploadProgress,null,[this.xhr.response])}),this._parameters.uploadLoad&&this.xhr.upload.addEventListener("load",()=>{Reflect.apply(this._parameters.uploadLoad,null,[this.xhr.response])}),this.xhr.upload.addEventListener("error",this._parameters.error?()=>{Reflect.apply(this._parameters.error,null,[this.xhr])}:()=>{console.log(this.xhr)})}_objectToURL(e,r){const s=[];for(const t in e)if(Reflect.ownKeys(e).includes(t)){const a=r?r+"["+t+"]":t,h=e[t];s.push(null!==h&&"object"==typeof h?this._objectToURL(h,a):encodeURIComponent(a)+"="+encodeURIComponent(h))}return s.join("&")}stop(){return this.xhr.abort(),this}}